<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SkyAI ‚Äî WebLLM in‚ÄëBrowser</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(135deg, #4f46e5, #9333ea); }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <div class="bg-white w-full max-w-xl p-6 rounded-2xl shadow-xl">
    <h1 class="text-3xl font-bold text-center text-purple-700 mb-4">SkyAI</h1>

    <textarea id="prompt" class="w-full border p-3 rounded mb-4"
      rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å..."></textarea>

    <button id="send"
      class="w-full bg-purple-700 text-white py-2 rounded-lg hover:bg-purple-800 transition">
      –û—Ç–ø—Ä–∞–≤–∏—Ç—å
    </button>

    <div id="response" class="mt-4 p-3 bg-gray-100 rounded min-h-[100px] whitespace-pre-wrap"></div>
  </div>

  <script type="module">
    import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";

    const responseDiv = document.getElementById("response");
    const sendBtn = document.getElementById("send");
    const promptInput = document.getElementById("prompt");

    async function init() {
      responseDiv.textContent = "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏ WebGPU...";
      if (!navigator.gpu) {
        responseDiv.textContent = "–û—à–∏–±–∫–∞: WebGPU –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ üò¢";
        return;
      }

      responseDiv.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏...";

      // –í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö WebLLM
      // –ù–∞–ø—Ä–∏–º–µ—Ä: "Llama-3-1-B-Instruct-q4f32_1-MLC" ‚Äî –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏
      const modelId = "Llama-3-1-B-Instruct-q4f32_1-MLC"; 

      let engine;
      try {
        engine = await CreateMLCEngine(modelId);
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏:", e);
        responseDiv.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –µ—ë –Ω–µ—Ç –≤ WebLLM.";
        return;
      }

      responseDiv.textContent = "–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ ‚Äî –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å.";

      sendBtn.disabled = false;

      sendBtn.onclick = async () => {
        const prompt = promptInput.value.trim();
        if (!prompt) return;

        responseDiv.textContent = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞‚Ä¶";
        try {
          const resp = await engine.chat.completions.create({
            messages: [{ role: "user", content: prompt }],
          });
          responseDiv.textContent = resp.choices[0].message.content;
        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:", err);
          responseDiv.textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.";
        }
      };
    }

    init();
  </script>
</body>
</html>
